{% extends "base.html" %}

{% block content %}
<h2>Inventory - Add New Books</h2>

<div class="container-message">
    <h3> User Logged in:{{ user }}</h3>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
            <p>{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>

<form method="POST" action="{{ url_for('Novel_inventory.add_book') }}">
    <input type="text" name="search_term" placeholder="Enter ISBN or SKU" required>
    <input type="number" name="stock" placeholder="Enter stock" required>
    <input type="number" name="price" placeholder="Enter price" required step="0.01">
    <button type="submit">Add Book To Inventory</button>
</form>


<!-- Manual Entry Form -->
{% if not_found and current_user.is_authenticated and current_user.role == 'manager' %}
    <h3>Book Not Found - Please Enter Details Manually</h3>
    <form method="POST" action="{{ url_for('Novel_inventory.add_book') }}">
        <input type="hidden" name="manual_add" value="true">
        
        <div class="form-group">
            <label>ISBN:</label>
            <input type="text" name="isbn" value="{{ form_data.isbn }}" placeholder="ISBN">
        </div>
        
        <div class="form-group">
            <label>Title*:</label>
            <input type="text" name="title" value="{{ form_data.title }}" placeholder="Book title" required>
        </div>
        
        <div class="form-group">
            <label>Authors*:</label>
            <input type="text" name="authors" value="{{ form_data.authors }}" placeholder="Author names, comma separated" required>
        </div>
        
        <div class="form-group">
            <label>Number of Pages:</label>
            <input type="number" name="number_of_pages" value="{{ form_data.number_of_pages }}" placeholder="Page count">
        </div>
        
        <div class="form-group">
            <label>Publishers:</label>
            <input type="text" name="publishers" value="{{ form_data.publishers }}" placeholder="Publisher names">
        </div>
        
        <div class="form-group">
            <label>Publish Date:</label>
            <input type="text" name="publish_date" value="{{ form_data.publish_date }}" placeholder="Publication date">
        </div>
        
        <div class="form-group">
            <label>Thumbnail URL:</label>
            <input type="text" name="thumbnail_url" value="{{ form_data.thumbnail_url }}" placeholder="Small cover image URL">
        </div>
        
        <div class="form-group">
            <label>Cover Image URL:</label>
            <input type="text" name="cover" value="{{ form_data.cover }}" placeholder="Large cover image URL">
        </div>
        
        <div class="form-group">
            <label>Stock*:</label>
            <input type="number" name="stock" value="{{ form_data.stock }}" min="0" required>
        </div>
        
        <div class="form-group">
            <label>Price*:</label>
            <input type="number" name="price" value="{{ form_data.price }}" min="0" step="0.01" required>
        </div>
        
        <button type="submit">Add Book Manually</button>
    </form>
{% endif %}
{% if book %}
<div class="success-message">
    <h3>Book Successfully Added!</h3>
    <p>Details for {{ book.title }}</p>
</div>

<table>
    <tr>
        <th>Cover</th>
        <th>ISBN</th>
        <th>Title</th>
        <th>Author</th>
        <th>Stock</th>
        <th>Price</th>
        <th>Publish Date</th>
        <th>Publishers</th>
        <th>Number of Pages</th>

    </tr>
    <tr>
        <td> <img src="{{book.thumbnail_url}}" alt="book cover thumbnail" width="100" height="150"/></td>
        <td>{{book.isbn}}</td>
        <td>{{book.title}}</td>
        <td>{{book.authors}}</td>
        <td>{{book.stock}}</td>
        <td>${{book.price}}</td>
        <td>{{book.publish_date}}</td>
        <td>{{book.publishers}}</td>
        <td>{{book.number_of_pages}}</td>
        
    
    </tr>
    
</table> 
{% endif %}

<ul>
    <li><a href="{{ url_for('Novel_login.dashboard') }}">Dashboard</a></li>

    {% if user.role == 'manager' %}
    <li><a href="{{ url_for('Novel_login.add_user') }}">Add New User</a></li>
    {% endif %}

    {% if user.role == 'cashier' %}
    <li><a href="{{ url_for('Novel_POS.process_sale') }}">Process Sale</a></li>
    {% endif %}

    <li><a class="active" href="{{ url_for('Novel_inventory.inventory') }}">Inventory</a></li>
    <li><a href="{{ url_for('Novel_cart.view_cart') }}">View Cart</a></li>

    <li style="float:right;"><a href="{{ url_for('Novel_login.logout') }}">Logout</a></li>
</ul>



{% endblock %}